<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Using with Truffle - NFTMart Docs</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="INTRO.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Basic Setup</li><li class="chapter-item expanded "><a href="Setting_Up_a_Local_NFTMart_Node.html"><strong aria-hidden="true">1.</strong> Setting Up a Local NFTMart Node</a></li><li class="chapter-item expanded affix "><li class="part-title">Ethereum Compatibility</li><li class="chapter-item expanded "><a href="Using_Ethereum_Libraries_to_Deploy_Smart_Contracts_on_NFTMart.html"><strong aria-hidden="true">2.</strong> Using Ethereum Libraries to Deploy Smart Contracts on NFTMart</a></li><li class="chapter-item expanded "><a href="Using_with_MetaMask.html"><strong aria-hidden="true">3.</strong> Using with MetaMask</a></li><li class="chapter-item expanded "><a href="Using_with_Remix.html"><strong aria-hidden="true">4.</strong> Using with Remix</a></li><li class="chapter-item expanded "><a href="Using_with_Truffle.html" class="active"><strong aria-hidden="true">5.</strong> Using with Truffle</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">NFTMart Docs</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="interacting-with-nftmart-using-truffle"><a class="header" href="#interacting-with-nftmart-using-truffle">Interacting with NFTMart Using Truffle</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>This guide walks through the process of deploying a Solidity-based smart
contract to a NFTMart node using <a href="https://www.trufflesuite.com/">Truffle</a>, a
commonly used development tool for smart contracts on Ethereum. Given NFTMart
Ethereum compatibility features, Truffle can be used directly with a NFTMart
node.</p>
<h2 id="checking-prerequisites"><a class="header" href="#checking-prerequisites">Checking Prerequisites</a></h2>
<p>We need to install Node.js (we'll use v15.x) and the npm package manager. You
can download directly from <a href="https://nodejs.org/en/download/">Node.js</a> or in your
terminal:</p>
<p>Ubuntu</p>
<pre><code>curl -sL https://deb.nodesource.com/setup_15.x | sudo -E bash -

sudo apt install -y nodejs
</code></pre>
<p>MacOS</p>
<pre><code># You can use homebrew (https://docs.brew.sh/Installation)
brew install node

# Or you can use nvm (https://github.com/nvm-sh/nvm)
nvm install node
</code></pre>
<h2 id="running-a-development-node"><a class="header" href="#running-a-development-node">Running a Development Node</a></h2>
<p>To set up a NFTMart development node, you can follow tutorial of <em>Setting Up a
Local NFTMart Node</em>.</p>
<h2 id="deploying-a-contract-to-nftmart-using-truffle"><a class="header" href="#deploying-a-contract-to-nftmart-using-truffle">Deploying a Contract to NFTMart Using Truffle</a></h2>
<p>To use most Truffle commands, you need to run them against an existing Truffle
project. So the first step is to create a Truffle project.</p>
<p>You can create a bare project template, but for those just getting started, you
can use <a href="https://www.trufflesuite.com/boxes">Truffle Boxes</a>, which are example
applications and project templates. We'll use the
<a href="https://www.trufflesuite.com/boxes/metacoin">MetaCoin box</a>, which creates a
token that can be transferred between accounts.</p>
<p>Let's start, follow the steps below.</p>
<p>1.Create a new directory for your Truffle project:</p>
<p><code>mkdir -p metacoin; cd metacoin</code></p>
<p>2.Download (&quot;unbox&quot;) the MetaCoin box:</p>
<p><code>truffle unbox metacoin</code></p>
<p>Once this operation is completed, you'll now have a project structure with the
following items:</p>
<p><strong>contracts/</strong>: Directory for Solidity contracts <strong>migrations/</strong>: Directory for
scriptable deployment files <strong>test/</strong>: Directory for test files for testing your
application and contracts <strong>truffle-config.js</strong>: Truffle configuration file</p>
<ol start="3">
<li>Create package.json, then configure the network in the truffle-config.js file
:</li>
</ol>
<pre><code>$ cat &gt; package.json &lt;&lt;EOF &amp;&amp; npm install
{
   &quot;name&quot;: &quot;metacoin&quot;,
   &quot;version&quot;: &quot;1.0.0&quot;,
   &quot;dependencies&quot;: {
      &quot;@openzeppelin/contracts&quot;: &quot;^4.5.0&quot;,
      &quot;@truffle/hdwallet-provider&quot;: &quot;^1.2.2&quot;,
      &quot;truffle&quot;: &quot;^5.1.66&quot;
   }
}
EOF
</code></pre>
<pre><code>$ cat &gt; truffle-config.js &lt;&lt;EOF
const HDWalletProvider = require('@truffle/hdwallet-provider');
// NFTMart Node Development Account Gerald
// address: 0x6Be02d1d3665660d22FF9624b7BE0551ee1Ac91b
const privateKeyDev =
   '99B3C12287537E38C90A9219D4CB074A89A16E9CDB20BF85728EBD97C343E342';

module.exports = {
   networks: {
      // Moonbeam Development Network
      development: {
         provider: () =&gt; {
            if (!privateKeyDev.trim()) {
               throw new Error(
                  'Please enter a private key with funds, you can use the default one'
               );
            }
            return new HDWalletProvider(
               privateKeyDev,
               'http://localhost:9933/'
            );
         },
         network_id: '*',
      },
   },
   // Solidity 0.5 Compiler
   compilers: {
      solc: {
         version: '^0.5',
      },
   },
   plugins: ['truffle-plugin-verify'],
};
EOF
</code></pre>
<p>Note that this is slightly different from
<a href="https://www.trufflesuite.com/ganache">Ganache</a>. The <strong>from</strong> parameter must be
configured here. The account <code>0x19E7E376E7C213B7E7e7e46cc70A5dD086DAff2A</code> is
pre-funded , and it's corresponding private key is also stored on the node.</p>
<p>Also, you should make sure you have enough token in your account. The Gerald
account comes with enough initial fund for testing purpose.</p>
<p>4.Compile the Truffle project</p>
<p>To compile a Truffle project, change to the root of the directory where the
project is located and then type the following into a terminal:</p>
<pre><code>/metacoin $ truffle compile

Compiling your contracts...
===========================
✓ Fetching solc version list from solc-bin. Attempt #1
✓ Fetching solc version list from solc-bin. Attempt #1
&gt; Compiling ./contracts/ConvertLib.sol
&gt; Compiling ./contracts/MetaCoin.sol
&gt; Compiling ./contracts/Migrations.sol
&gt; Artifacts written to /home/aaron/MetaCoin/build/contracts
&gt; Compiled successfully using:
   - solc: 0.5.17+commit.d19bba13.Emscripten.clang
</code></pre>
<p>5.Deploy the Truffle project</p>
<p>To deploy the Truffle project, execute <code>truffle migrate</code>:</p>
<pre><code>/metacoin $ truffle migrate


Compiling your contracts...
===========================
✓ Fetching solc version list from solc-bin. Attempt #1
✓ Fetching solc version list from solc-bin. Attempt #1
&gt; Everything is up to date, there is nothing to compile.


Starting migrations...
======================
&gt; Network name:    'development'
&gt; Network id:      12191
&gt; Block gas limit: 60000000 (0x3938700)


1_initial_migration.js
======================

   Deploying 'Migrations'
   ----------------------
   &gt; transaction hash:    0x41a30adc57db5c2708b82b71b986649e330c998159f6e4c510bd47bd6da7ec97
   &gt; Blocks: 0            Seconds: 0
   &gt; contract address:    0xDc552396caEc809752fED0c5E23fd3983766e758
   &gt; block number:        249
   &gt; block timestamp:     1649757912
   &gt; account:             0x6Be02d1d3665660d22FF9624b7BE0551ee1Ac91b
   &gt; balance:             9998032.3222110515
   &gt; gas used:            165475 (0x28663)
   &gt; gas price:           2.5000045 gwei
   &gt; value sent:          0 ETH
   &gt; total cost:          0.0004136882446375 ETH

   &gt; Saving migration to chain.
   &gt; Saving artifacts
   -------------------------------------
   &gt; Total cost:     0.0004136882446375 ETH


2_deploy_contracts.js
=====================

   Deploying 'ConvertLib'
   ----------------------
   &gt; transaction hash:    0x35c2f3deb276f8786dc87fd616ac753f18c2e1fab8a469f3037c803d6794e7b6
   &gt; Blocks: 0            Seconds: 4
   &gt; contract address:    0xD81C7319c85fcd6e1F0893b3988BeBab6247Adbc
   &gt; block number:        251
   &gt; block timestamp:     1649757924
   &gt; account:             0x6Be02d1d3665660d22FF9624b7BE0551ee1Ac91b
   &gt; balance:             9997679.324075656
   &gt; gas used:            95458 (0x174e2)
   &gt; gas price:           2.5000045 gwei
   &gt; value sent:          0 ETH
   &gt; total cost:          0.000238645429561 ETH


   Linking
   -------
   * Contract: MetaCoin &lt;--&gt; Library: ConvertLib (at address: 0xD81C7319c85fcd6e1F0893b3988BeBab6247Adbc)

   Deploying 'MetaCoin'
   --------------------
   &gt; transaction hash:    0x647a7b72ecb4a6da9f2af6ce5f6e4f1ac74f408f674bb78fbaf70aa6564795bc
   &gt; Blocks: 0            Seconds: 4
   &gt; contract address:    0x596fB37d99bd679d1af76fBCB658f7a1a31A1205
   &gt; block number:        252
   &gt; block timestamp:     1649757930
   &gt; account:             0x6Be02d1d3665660d22FF9624b7BE0551ee1Ac91b
   &gt; balance:             9996957.6602766635
   &gt; gas used:            288665 (0x46799)
   &gt; gas price:           2.5000045 gwei
   &gt; value sent:          0 ETH
   &gt; total cost:          0.0007216637989925 ETH

   &gt; Saving migration to chain.
   &gt; Saving artifacts
   -------------------------------------
   &gt; Total cost:     0.0009603092285535 ETH

Summary
=======
&gt; Total deployments:   3
&gt; Final cost:          0.001373997473191 ETH
</code></pre>
<p>6.Interacting with your contracts</p>
<p>Contract abstractions are the bread and butter of interacting with Ethereum
contracts from Javascript. In short, contract abstractions are wrapper code that
makes interaction with your contracts easy, in a way that lets you forget about
the many engines and gears executing under the hood. Truffle uses its own
contract abstraction via the
<a href="https://github.com/trufflesuite/truffle/tree/master/packages/contract">@truffle/contract</a>
module, and it is this contract abstraction that's described below.</p>
<pre><code class="language-solidity">pragma solidity &gt;=0.4.25 &lt;0.6.0;

import &quot;./ConvertLib.sol&quot;;

// This is just a simple example of a coin-like contract.
// It is not standards compatible and cannot be expected to talk to other
// coin/token contracts. If you want to create a standards-compliant
// token, see: https://github.com/ConsenSys/Tokens. Cheers!

contract MetaCoin {
    mapping (address =&gt; uint) balances;

    event Transfer(address indexed _from, address indexed _to, uint256 _value);

    constructor() public {
        balances[tx.origin] = 10000;
    }

    function sendCoin(address receiver, uint amount) public returns(bool sufficient) {
        if (balances[msg.sender] &lt; amount) return false;
        balances[msg.sender] -= amount;
        balances[receiver] += amount;
        emit Transfer(msg.sender, receiver, amount);
        return true;
    }

    function getBalanceInEth(address addr) public view returns(uint){
        return ConvertLib.convert(getBalance(addr),2);
    }

    function getBalance(address addr) public view returns(uint) {
        return balances[addr];
    }
}
</code></pre>
<p>Now, let's look at the Javascript object called <code>MetaCoin</code> provided for us by
Truffle, as made available in the
<a href="https://www.trufflesuite.com/docs/truffle/getting-started/using-truffle-develop-and-the-console">Truffle console</a>:</p>
<pre><code>truffle(development)&gt; let instance = await MetaCoin.deployed()
truffle(development)&gt; instance


   ...

    methods: {
      sendCoin: [Function: bound _createTxObject],
      '0x90b98a11': [Function: bound _createTxObject],
      'sendCoin(address,uint256)': [Function: bound _createTxObject],
      getBalanceInEth: [Function: bound _createTxObject],
      '0x7bd703e8': [Function: bound _createTxObject],
      'getBalanceInEth(address)': [Function: bound _createTxObject],
      getBalance: [Function: bound _createTxObject],
      '0xf8b2cb4f': [Function: bound _createTxObject],
      'getBalance(address)': [Function: bound _createTxObject]
    },
    events: {
      Transfer: [Function: bound ],
      '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef': [Function: bound ],
      'Transfer(address,address,uint256)': [Function: bound ],
      allEvents: [Function: bound ]
    },
    _address: '0x08425D9Df219f93d5763c3e85204cb5B4cE33aAa',

        
 ...
</code></pre>
<p>Making a transaction:</p>
<p>There are three functions on the MetaCoin contract that we can execute. If you
analyze each of them, you'll see that <code>sendCoin</code> is the only function that aims
to make changes to the network. The goal of <code>sendCoin</code> is to &quot;send&quot; some Meta
coins from one account to the next, and these changes should persist.</p>
<p>When calling <code>sendCoin</code>, we'll execute it as a transaction. In the following
example, we'll send 10 Meta coin from one account to another, in a way that
persists changes on the network:</p>
<pre><code>truffle(development)&gt; let accounts = await web3.eth.getAccounts()
undefined
truffle(development)&gt; instance.sendCoin(&quot;0x6Be02d1d3665660d22FF9624b7BE0551ee1Ac91b&quot;, 10, {from: accounts[0]})
{
  tx: '0xf080c9d277f78bb29cb5a5619c1c5f4bdc79e426d0fb3f7d259928fe973384dc',
  receipt: {
    blockHash: '0x02aae907afd086a36d0b3f417fd3b205b9c1c757a72b2e20da83666d2e36e9cb',
    blockNumber: 40,
    contractAddress: null,
    cumulativeGasUsed: 47308,
    from: '0x19e7e376e7c213b7e7e7e46cc70a5dd086daff2a',
    gasUsed: 47308,
    logs: [ [Object] ],
    logsBloom: '0x80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000800000000000000000000000000000000000000000000000000000000020000000000000000000000010000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000002000000000000000020000800000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000008000000000000000000000000',
    status: true,
    to: '0x08425d9df219f93d5763c3e85204cb5b4ce33aaa',
    transactionHash: '0xf080c9d277f78bb29cb5a5619c1c5f4bdc79e426d0fb3f7d259928fe973384dc',
    transactionIndex: 0,
    rawLogs: [ [Object] ]
  },
  logs: [
    {
      address: '0x08425D9Df219f93d5763c3e85204cb5B4cE33aAa',
      blockHash: '0x02aae907afd086a36d0b3f417fd3b205b9c1c757a72b2e20da83666d2e36e9cb',
      blockNumber: 40,
      logIndex: 0,
      removed: false,
      transactionHash: '0xf080c9d277f78bb29cb5a5619c1c5f4bdc79e426d0fb3f7d259928fe973384dc',
      transactionIndex: 0,
      transactionLogIndex: '0x0',
      id: 'log_1a8b84e8',
      event: 'Transfer',
      args: [Result]
    }
  ]
}
</code></pre>
<p>Making a call:</p>
<p>Continuing with MetaCoin, notice the <code>getBalance</code> function is a great candidate
for reading data from the network. It doesn't need to make any changes, as it
just returns the MetaCoin balance of the address passed to it. Let's give it a
shot:</p>
<pre><code>truffle(development)&gt; let balance = await instance.getBalance(accounts[0])
undefined
truffle(development)&gt;  balance.toNumber()
9990
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="Using_with_Remix.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="Using_with_Remix.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
